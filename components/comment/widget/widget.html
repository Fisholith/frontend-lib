<div
	class="comment-widget"
	:class="{ 'comment-widget-translating': isTranslating }"
	:id="`comment-pagination-${id}`"
	>
	<div v-if="!hasLoaded && !hasError">
		<app-loading />
	</div>

	<div v-if="hasError">
		<div class="alert alert-warning">
			<translate>Couldn't fetch comments for game.</translate>
		</div>
	</div>

	<div v-if="hasLoaded && !hasError">
		<div v-if="!noIntro">
			<div v-if="!commentsCount">
				<p>
					<em><translate>Let us know your thoughts and be the first to comment!</translate></em>
				</p>
				<br>
			</div>
		</div>

		<!-- Comment Add Form -->
		<div v-if="app.user">
			<app-comment-widget-add-form
				:resource="resource"
				:resource-id="resourceId"
				@submit="onCommentAdd"
				/>
		</div>

		<div v-if="!app.user" class="alert alert-info">
			<p>You must be <a v-app-auth-required :href="loginUrl">logged in</a> to Game Jolt to post a comment.</p>
		</div>

		<hr>

		<div class="comment-widget-translate-btn" v-if="allowTranslate">
			<button class="btn btn-block btn-outline"
				v-if="!isShowingTranslations"
				:disabled="isTranslating"
				@click="toggleTranslate"
				>
				<translate translate-comment="%{ lang } is passed in with the current language">
					Translate comments to %{ lang }
				</translate>
			</button>

			<div v-if="isShowingTranslations">
				<button class="btn btn-block btn-outline"
					@click="toggleTranslate"
					>
					<translate>Show original comments</translate>
					<span class="translate-button-branding">
						<translate>translated by</translate>
						<img src="./google-logo.png" alt="Google">
					</span>
				</button>

				<br>
				<div class="small text-muted text-center">
					<translate>Automatic translations use Google Translate and may not be completely accurate.</translate>
				</div>
			</div>
		</div>

		<!-- Comments List -->
		<div class="comment-widget-comments">
			<div class="comment-widget-thread anim-fade-in no-animate-leave no-animate-xs"
				v-for="comment of comments"
				:key="comment.id"
				>

				<!-- Comment -->
				<app-comment-widget-comment
					:comment="comment"
					:is-highlighted="highlightedComment === comment.id"
					/>

				<!-- Child Comments -->
				<div v-if="childComments[ comment.id ]">

					<div class="anim-fade-in no-animate-leave no-animate-xs"
						v-for="child of childComments[ comment.id ]"
						:key="child.id"
						>
						<app-comment-widget-comment
							:comment="child"
							:is-child="true"
							:is-highlighted="highlightedComment === child.id"
							/>
					</div>

				</div>

				<!--
					Don't include the form in the DOM until we need it.
					When the if is triggered, the scroll-when will trigger and we'll scroll to
					the reply box.
				-->
				<!--<div v-if="replyingTo == comment.id" gj-scroll-when>-->
				<div v-if="replyingTo === comment.id">
					<app-comment-widget-add-form
						:resource="resource"
						:resource-id="resourceId"
						:parent-id="comment.id"
						@submit="onReplyAdd"
						/>
				</div>
			</div>
		</div>

		<app-pagination
			v-if="perPage && parentCount"
			:pager="true"
			:items-per-page="perPage"
			:total-items="parentCount"
			:current-page="currentPage"
			:prevent-url-change="true"
			query-param="comment_page"
			@pagechange="onPageChange"
			/>
	</div>
</div>
