<div>
	<div
		class="comment-widget-comment clearfix"
		:id="`comment-${comment.id}`"
		:class="{
			'comment-widget-comment-is-child': isChild,
			'comment-widget-comment-highlighted': isHighlighted,
		}"
		>

		<div class="comment-widget-comment-avatar">
			<app-user-avatar :user="comment.user" />
		</div>

		<div class="comment-widget-comment-body">

			<div class="comment-widget-comment-title h5">
				<translate
					class="comment-widget-comment-owner tag tag-active visible-xs pull-right"
					v-if="isOwner"
					>
					Owner
				</translate>
				<a :href="Environment.wttfBaseUrl + comment.user.url">
					{{ comment.user.display_name }}
					<small>@{{ comment.user.username }}</small>
				</a>
				<app-time-ago class="comment-widget-comment-time" :date="comment.posted_on" />
				<translate v-if="isOwner" class="comment-widget-comment-owner tag tag-active hidden-xs">Owner</translate>
			</div>

			<app-fade-collapse
				:collapse-height="300"
				:is-open="showFullComment"
				@required="canToggleComment = true"
				>
				<div class="comment-widget-comment-content"
					v-html="widget.isShowingTranslations && widget.translations[ comment.id ]
						? widget.translations[ comment.id ].content
						: comment.comment_compiled
					"
					>
				</div>
			</app-fade-collapse>

			<a class="hidden-text-expander"
				v-if="canToggleComment"
				@click="showFullComment = !showFullComment"
				v-app-track-event="`comment-widget:toggle-full-content`"
				>
			</a>

			<div class="comment-widget-comment-videos" v-if="comment.videos.length">
				<div class="row">
					<div
						class="col-xs-6"
						v-for="video of comment.videos.slice( 0, showAllVideos ? 10 : 2)"
						:key="video.id"
						>
						<app-comment-video-thumbnail :video="video" />
					</div>
				</div>

				<div class="comment-widget-comment-videos-more-link"
					v-if="comment.videos.length > 2 && !showAllVideos"
					>
					<a class="small link-muted"
						@click="showAllVideos = true"
						v-app-track-event="`comment-widget:more-videos`"
						>
						<translate
							:translate-n="comment.videos.length - 2"
							:translate-params="{ count: comment.videos.length - 2 }"
							translate-plural="+%{ count } more videos"
							>
							+1 more video
						</translate>
					</a>
				</div>
				<br>
			</div>

			<div class="comment-widget-comment-meta">

				<!--
					Comment Voting
				-->
				<a
					class="comment-widget-comment-voting"
					v-if="canVote"
					v-app-tooltip="votingTooltip"
					@click="onVoteClick"
					v-app-track-event="`comment-widget:vote-click`"
					>

					<!--
						We make it a sparse button that's highlighted when they've voted on the comment,
						otherwise it's just a simple clear icon.
					-->
					<span :class="{ 'btn btn-sm btn-sparse active': comment.user_vote }">
						<app-jolticon icon="thumbs-up" />
					</span>

					<span class="blip light filled" v-if="comment.votes > 0">
						<span class="blip-caret"></span>
						<span class="blip-count">{{ comment.votes }}</span>
					</span>
				</a>

				<span class="blip light no-caret filled"
					v-if="!canVote && comment.votes > 0"
					v-app-tooltip="votingTooltip"
					v-app-track-event="`comment-widget:vote-click-notallowed`"
					>

					<span class="blip-count">{{ comment.votes }}</span>
				</span>

				<!--
					Only show the reply if isn't a child.
					We only show it on the parent comments.
				-->
				<span v-if="!isChild">
					<span class="dot-separator"></span>

					<a @click="onReplyClick" v-app-track-event="`comment-widget:reply-click`">
						<app-jolticon icon="reply" />
						<translate>Reply</translate>
					</a>

				</span>

				<span v-if="canFollow">
					<span class="dot-separator"></span>

					<a
						v-if="!widget.subscriptions[ comment.id ]"
						@click="onFollowClick"
						v-app-tooltip="$gettext( 'Get notifications when people post new replies to this thread.' )"
						v-app-track-event="`comment-widget:follow-click`"
						>
						<app-jolticon icon="subscribe" />
						<translate>Follow Thread</translate>
					</a>

					<a class="following"
						v-else
						@click="onFollowClick"
						v-app-track-event="`comment-widget:follow-click`"
						>
						<app-jolticon icon="subscribed" />
						<translate>Stop Following</translate>
					</a>
				</span>

				<span v-if="app.user && (app.user.id !== comment.user || app.user.permissionLevel >= 3)">
					<span class="dot-separator"></span>

					<a
						v-app-tooltip="$gettext( 'More Options' )"
						v-app-popover-trigger="`comment-more-options-${comment.id}`"
						>
						<app-jolticon icon="ellipsis-h" />
					</a>
				</span>

			</div>

		</div>

	</div>

	<app-popover
		v-if="app.user"
		:popover-id="`comment-more-options-${comment.id}`"
		:append-to-body="true"
		>
		<div class="list-group list-group-dark">
			<a class="list-group-item has-icon"
				v-if="app.user.id !== comment.user"
				@click="report( comment )"
				>
				<app-jolticon icon="flag warning" />
				<translate>Report Comment</translate>
			</a>
			<a class="list-group-item has-icon"
				v-if="app.user.permission_level >= 3"
				:href="`${Environment.baseUrl}/moderate/comments/remove/${ comment.id}`"
				target="_blank"
				>
				<app-jolticon icon="remove warning" />
				Remove Comment
			</a>
		</div>
	</app-popover>

</div>
