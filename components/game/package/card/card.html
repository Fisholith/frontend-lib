<div class="game-package-card fill-darker">

	<div class="game-package-card-pricing">
		<span class="game-package-card-pricing-amount">
			<span class="game-package-card-pricing-currency">$</span>10<span class="game-package-card-pricing-decimal">.00</span>
		</span>
		<br><span class="game-package-card-pricing-tag muted">or more</span>
		<!--<span class="game-package-card-pricing-tag">name your price</span>-->
		<!--<span class="game-package-card-pricing-amount">
			FREE
		</span>-->
	</div>

	<div class="game-package-card-body">

		<h4 class="game-package-card-title">
			{{ (ctrl.package.title || ctrl.game.title) }}
		</h4>

		<div class="game-package-card-meta">

			<!--
				In client, if the game is installed.
			-->
			<span ng-if="ctrl.localPackage">
				<!-- Reduce number of watches -->
				<span ng-if="ctrl.localPackage.isInstalling()">
					<span ng-if="!ctrl.localPackage.isPatchPaused()">
						<span class="tag tag-blue" ng-if="ctrl.localPackage.isInstalling()">INSTALLING</span>
						<span class="tag tag-pink" ng-if="ctrl.localPackage.didInstallFail()">INSTALL FAILED</span>
					</span>
					<span ng-if="ctrl.localPackage.isPatchPaused()">
						<span class="tag">INSTALL PAUSED</span>
					</span>
				</span>
				<span ng-if="ctrl.localPackage.isUpdating()">
					<span ng-if="!ctrl.localPackage.isPatchPaused()">
						<span class="tag tag-blue" ng-if="ctrl.localPackage.isUpdating()">UPDATING</span>
						<span class="tag tag-pink" ng-if="ctrl.localPackage.didUpdateFail()">UPDATE FAILED</span>
					</span>
					<span ng-if="ctrl.localPackage.isPatchPaused()">
						<span class="tag">UPDATE PAUSED</span>
					</span>
				</span>
				<span class="tag tag-active" ng-if="ctrl.localPackage.isSettled() && !ctrl.localPackage.isRunning()">INSTALLED</span>
				<span class="tag tag-active" ng-if="ctrl.localPackage.isRunning()">RUNNING</span>
				<span class="tag" ng-if="ctrl.localPackage.isRemoving()">REMOVING</span>
				<span class="dot-separator"></span>
			</span>

			<span
				ng-repeat="supportKey in ::ctrl.support"
				ng-class="::'jolticon jolticon-' + ctrl.supportInfo[ supportKey ].icon"
				tooltip="{{ ::ctrl.supportInfo[ supportKey ].tooltip }}"
				>
			</span>

			<span class="dot-separator" ng-if="ctrl.support.length"></span>

			<span ng-if="ctrl.showcasedRelease">
				<span class="game-package-card-version">
					Version:
					<strong>{{ ctrl.showcasedRelease.version_number }}</strong>
				</span>

				<span class="dot-separator"></span>

				<span class="game-package-card-date" am-time-ago="ctrl.showcasedRelease.published_on"></span>
			</span>
		</div>

		<div class="game-package-card-description" ng-if="ctrl.package.description">
			<gj-fade-collapse
				fade-collapse-height="100"
				fade-collapse-is-open="ctrl.showFullDescription"
				fade-collapse-is-required="ctrl.canToggleDescription"
				>

				<p ng-bind-html="ctrl.package.description | linky"></p>

			</gj-fade-collapse>
		</div>

		<a class="hidden-text-expander"
			ng-if="ctrl.canToggleDescription"
			ng-click="ctrl.showFullDescription = !ctrl.showFullDescription"
			gj-track-event="game-package-card:show-full-description"
			></a>

		<div class="alert alert-warning" ng-if="!ctrl.showcasedRelease">
			No published releases yet.
		</div>

		<div gj-expand-when="ctrl.isPaymentOpen" class="payment-well-expander">
			<div class="payment-well">

				<p>
					The developer has set the price of this game to <strong>$10</strong>, but you are able to support them by giving more.
				</p>

				<p>
					<strong class="payment-well-label">Name your price:</strong>
					<!--<button class="btn btn-outline">
						$1
					</button>
					<button class="btn btn-outline">
						$5
					</button>
					<button class="btn btn-outline">
						$10
					</button>
					<button class="btn btn-outline">
						$20
					</button>
					<span style="display: inline-block; margin-left: 15px">(<a class="link-muted">custom amount</a>)</span>-->
					<span class="payment-well-amount-input">
						<span class="payment-well-amount-input-currency">$</span>
						<input type="text" class="form-control" gj-focus-when>
					</span>
					<span class="text-muted">($10 or more)</span>
				</p>

				<p>
					<strong class="payment-well-label">Checkout with:</strong>
					<a class="btn btn-outline" href="/checkout" target="_self">
						<span class="jolticon jolticon-credit-card"></span>
						Card
					</a>
					<button class="btn btn-outline">
						PayPal
					</button>
				</p>

				<hr>

				<span class="jolticon jolticon-chevron-right middle"></span>
				<a class="link-unstyled small">
					No thanks, take to me to the download.
				</a>
			</div>
		</div>

		<!--
			The buttons are so different for client that we put them in a child component.
			They will only be available on WTTF since they're pushed in the client component there.'
		-->
		<div class="game-package-card-buttons" ng-if="::Environment.isClient">
			<gj-client-package-card-options></gj-client-package-card-options>
		</div>

		<div class="game-package-card-buttons" ng-if="::false && !Environment.isClient">

			<button class="btn btn-primary-outline"
				ng-if="::ctrl.browserBuild"
				ng-click="ctrl.buildClick( ctrl.browserBuild )"
				ng-class="{ 'btn-block': Screen.isXs }"
				>

				<span class="jolticon jolticon-play"></span>
				Play
				<span class="jolticon-addon jolticon" ng-class="::'jolticon-' + ctrl.showcasedBrowserIcon"></span>
			</button>

				<!--ng-click="ctrl.buildClick( ctrl.downloadableBuild )"-->
			<button class="btn btn-success-outline"
				ng-if="::ctrl.downloadableBuild"
				ng-class="{ 'btn-block': Screen.isXs }"
				ng-click="ctrl.isPaymentOpen = true"
				>

				<span class="jolticon jolticon-download"></span>
				Download
				<small ng-if="::ctrl.supportInfo[ ctrl.showcasedOs ].arch == '64'">64-bit</small>
				<small>({{ ::ctrl.downloadableBuild.primary_file.filesize | filesize }})</small>
				<span class="jolticon-addon jolticon" ng-class="::'jolticon-' + ctrl.showcasedOsIcon"></span>
			</button>

			<!--
				If this package only has "Other" builds, then we make it look like a download
				button with a [...] after.
				If the package has normal builds too, then we just show it as a more options sparse button.
			-->
			<button class="btn"
				ng-if="::ctrl.extraBuilds.length"
				ng-class="{ 'btn-success-outline': ctrl.otherOnly, 'btn-outline': !ctrl.otherOnly, 'btn-block': Screen.isXs }"
				gj-popover-trigger="game-package-card-options-{{ ctrl.package.id }}"
				gj-track-event="game-package-card:more-options"
				>
				<span class="jolticon jolticon-ellipsis-h"></span>
				<span ng-if="::ctrl.otherOnly">
					<span class="jolticon jolticon-download"></span>
					<span>Download</span>
					<span class="jolticon-addon jolticon jolticon-other-os"></span>
				</span>
				<span ng-if="::!ctrl.otherOnly">more</span>
			</button>

			<gj-popover popover-id="game-package-card-options-{{ ctrl.package.id }}">
				<div class="list-group nowrap">

					<a class="list-group-item has-icon"
						ng-repeat="extraBuild in ::ctrl.extraBuilds track by extraBuild.icon + '-' + extraBuild.build.id"
						ng-click="ctrl.buildClick( extraBuild.build )"
						gj-track-event="game-package-card:more-options:click-option"
						>
						<span ng-class="::'jolticon jolticon-' + extraBuild.icon"></span>

						<!--
							We show the filename if it's an "Other" build.
						-->
						<span ng-if="::!extraBuild.build.os_other">
							{{ ::extraBuild.type == Game_Build.TYPE_DOWNLOADABLE ? 'Download' : 'Play' }}
						</span>
						<span ng-if="::extraBuild.build.os_other">{{ ::extraBuild.build.primary_file.filename }}</span>

						<small ng-if="::extraBuild.arch == '64'">64-bit</small>

						<small class="text-muted">({{ ::extraBuild.build.primary_file.filesize | filesize }})</small>

						<!--
							If the version is different than the main release, then show it.
						-->
						<span class="tiny" ng-if="::extraBuild.build.game_release_id != ctrl.showcasedRelease.id">
							<em>v{{ ::extraBuild.build._release.version_number }}</em>
						</span>
					</a>
				</div>
			</gj-popover>

		</div>

		<button class="btn btn-success-outline"
			ng-class="{ 'btn-block': Screen.isXs }"
			ng-click="ctrl.isPaymentOpen = !ctrl.isPaymentOpen"
			>

			<span class="jolticon jolticon-heart"></span>
			Buy Now
		</button>

		<span class="game-package-card-payment-what-link" ng-if="!ctrl.isWhatOpen">
			(<a class="link-help" ng-click="ctrl.isWhatOpen = true">What do you get?</a>)
		</span>

		<div gj-expand-when="ctrl.isWhatOpen" class="payment-well-expander">
			<div class="payment-well">

				<div ng-repeat="build in ctrl.builds">
					<!--<span ng-class="::'jolticon jolticon-' + extraBuild.icon"></span>-->

					{{ ::build.primary_file.filename }}
					<!--<small ng-if="extraBuild.arch == '64'">64-bit</small>-->

					<small class="text-muted">({{ build.primary_file.filesize | filesize }})</small>
				</div>

				<br>

				<small>And really warm feelings for supporting an indie developer!</small>

			</div>
		</div>

	</div>
</div>
