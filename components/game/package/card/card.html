<div class="game-package-card fill-darker">

	<div class="game-package-card-body">

		<h4 class="game-package-card-title">
			{{ (ctrl.package.title || ctrl.game.title) }}
		</h4>

		<div class="game-package-card-meta">

			<!--
				In client, if the game is installed.
			-->
			<span ng-if="ctrl.localPackage">
				<!-- Reduce number of watches -->
				<span ng-if="ctrl.localPackage.isInstalling()">
					<span ng-if="!ctrl.localPackage.isPatchPaused()">
						<span class="tag tag-blue" ng-if="ctrl.localPackage.isInstalling()" translate>INSTALLING</span>
						<span class="tag tag-pink" ng-if="ctrl.localPackage.didInstallFail()" translate>INSTALL FAILED</span>
					</span>
					<span ng-if="ctrl.localPackage.isPatchPaused()">
						<span class="tag" translate>INSTALL PAUSED</span>
					</span>
				</span>
				<span ng-if="ctrl.localPackage.isUpdating()">
					<span ng-if="!ctrl.localPackage.isPatchPaused()">
						<span class="tag tag-blue" ng-if="ctrl.localPackage.isUpdating()" translate>UPDATING</span>
						<span class="tag tag-pink" ng-if="ctrl.localPackage.didUpdateFail()" translate>UPDATE FAILED</span>
					</span>
					<span ng-if="ctrl.localPackage.isPatchPaused()">
						<span class="tag" translate>UPDATE PAUSED</span>
					</span>
				</span>
				<span class="tag tag-active" ng-if="ctrl.localPackage.isSettled() && !ctrl.localPackage.isRunning()" translate>INSTALLED</span>
				<span class="tag tag-active" ng-if="ctrl.localPackage.isRunning()" translate>RUNNING</span>
				<span class="tag" ng-if="ctrl.localPackage.isRemoving()" translate>REMOVING</span>
				<span class="dot-separator"></span>
			</span>

			<span
				ng-repeat="supportKey in ::ctrl.support"
				ng-class="::'jolticon jolticon-' + ctrl.supportInfo[ supportKey ].icon"
				tooltip="{{ ::ctrl.supportInfo[ supportKey ].tooltip }}"
				>
			</span>

			<span class="dot-separator" ng-if="ctrl.support.length"></span>

			<span ng-if="ctrl.showcasedRelease">
				<span class="game-package-card-version">
					<span translate>Version:</span>
					<strong>{{ ctrl.showcasedRelease.version_number }}</strong>
				</span>

				<span class="dot-separator"></span>

				<span class="game-package-card-date" am-time-ago="ctrl.showcasedRelease.published_on"></span>
			</span>
		</div>

		<div class="game-package-card-description" ng-if="ctrl.package.description">
			<gj-fade-collapse
				fade-collapse-height="100"
				fade-collapse-is-open="ctrl.showFullDescription"
				fade-collapse-is-required="ctrl.canToggleDescription"
				>

				<p ng-bind-html="ctrl.package.description | linky"></p>

			</gj-fade-collapse>
		</div>

		<a class="hidden-text-expander"
			ng-if="ctrl.canToggleDescription"
			ng-click="ctrl.showFullDescription = !ctrl.showFullDescription"
			gj-track-event="game-package-card:show-full-description"
			></a>

		<div class="alert alert-warning" ng-if="!ctrl.showcasedRelease" translate>
			No published releases yet.
		</div>

		<!--
			The buttons are so different for client that we put them in a child component.
			They will only be available on WTTF since they're pushed in the client component there.'
		-->
		<div class="game-package-card-buttons" ng-if="::Environment.isClient">
			<gj-client-package-card-options></gj-client-package-card-options>
		</div>

		<div class="game-package-card-buttons" ng-if="::!Environment.isClient">

			<button class="btn btn-primary-outline"
				ng-if="::ctrl.browserBuild"
				ng-click="ctrl.buildClick( ctrl.browserBuild )"
				ng-class="{ 'btn-block': Screen.isXs }"
				>

				<span class="jolticon jolticon-play"></span>
				<span translate>Play</span>
				<span class="jolticon-addon jolticon" ng-class="::'jolticon-' + ctrl.showcasedBrowserIcon"></span>
			</button>

			<button class="btn btn-success-outline"
				ng-if="::ctrl.downloadableBuild"
				ng-click="ctrl.buildClick( ctrl.downloadableBuild )"
				ng-class="{ 'btn-block': Screen.isXs }"
				>

				<span class="jolticon jolticon-download"></span>
				<span translate>Download</span>
				<small ng-if="::ctrl.supportInfo[ ctrl.showcasedOs ].arch == '64'" translate>64-bit</small>
				<small>({{ ::ctrl.downloadableBuild.primary_file.filesize | filesize }})</small>
				<span class="jolticon-addon jolticon" ng-class="::'jolticon-' + ctrl.showcasedOsIcon"></span>
			</button>

			<!--
				If this package only has "Other" builds, then we make it look like a download
				button with a [...] after.
				If the package has normal builds too, then we just show it as a more options sparse button.
			-->
			<button class="btn"
				ng-if="::ctrl.extraBuilds.length"
				ng-class="{ 'btn-success-outline': ctrl.otherOnly, 'btn-outline': !ctrl.otherOnly, 'btn-block': Screen.isXs }"
				gj-popover-trigger="game-package-card-options-{{ ctrl.package.id }}"
				gj-track-event="game-package-card:more-options"
				>
				<span class="jolticon jolticon-ellipsis-h"></span>
				<span ng-if="::ctrl.otherOnly">
					<span class="jolticon jolticon-download"></span>
					<span translate>Download</span>
					<span class="jolticon-addon jolticon jolticon-other-os"></span>
				</span>
				<span ng-if="::!ctrl.otherOnly" translate>more</span>
			</button>

			<gj-popover popover-id="game-package-card-options-{{ ctrl.package.id }}">
				<div class="list-group nowrap">

					<a class="list-group-item has-icon"
						ng-repeat="extraBuild in ::ctrl.extraBuilds track by extraBuild.icon + '-' + extraBuild.build.id"
						ng-click="ctrl.buildClick( extraBuild.build, true )"
						gj-track-event="game-package-card:more-options:click-option"
						>
						<span ng-class="::'jolticon jolticon-' + extraBuild.icon"></span>

						<!--
							We show the filename if it's an "Other" build.
						-->
						<span ng-if="::!extraBuild.build.os_other" ng-switch="::extraBuild.build.type">
							<span ng-switch-when="downloadable" translate>
								Download
							</span>
							<span ng-switch-when="rom" translate translate-scope="{ platform: ctrl.emulatorInfo[ extraBuild.build.emulator_type ] }" translate-comment="{{ platform }} will be the platform we are downloading for, such as Game Boy, NES, etc.">
								Download {{ platform }} ROM
							</span>
							<span ng-switch-default translate>
								Play
							</span>
						</span>

						<span ng-if="::extraBuild.build.os_other">
							{{ ::extraBuild.build.primary_file.filename }}
						</span>

						<small ng-if="::extraBuild.arch == '64'" translate>64-bit</small>

						<small class="text-muted">({{ ::extraBuild.build.primary_file.filesize | filesize }})</small>

						<!--
							If the version is different than the main release, then show it.
						-->
						<span class="tiny" ng-if="::extraBuild.build.game_release_id != ctrl.showcasedRelease.id">
							<em>v{{ ::extraBuild.build._release.version_number }}</em>
						</span>
					</a>
				</div>
			</gj-popover>

		</div>

	</div>
</div>
